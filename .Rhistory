library(geofi)
library(ggplot2)
library(dplyr)
library(janitor)
library(tidyr)
municipalities <- get_municipalities(year = 2019, scale = 4500)
ggplot(municipalities) +
geom_sf(aes(fill = as.integer(kunta)))
zipcodes <- get_zipcodes(year = 2019)
View(zipcodes)
# check kuopio
str(municipalities)
municipalities %>%
filter(nimi == 'Kuopio')
str(zipcodes)
zipcodes_kuopio <- zipcodes %>%
filter(kuntanro == 279)
zipcodes_kuopio <- zipcodes %>%
filter(kunta == 279)
View(zipcodes_kuopio)
municipalities %>%
filter(nimi == 'Kuopio')
View(zipcodes)
municipalities %>%
filter(nimi == 'Kuopio')
# str(zipcodes)
zipcodes_kuopio <- zipcodes %>%
filter(kunta == 297)
ggplot(zipcodes_kuopio) +
geom_sf(aes(fill = as.integer(posti_alue)))
library(leaflet)
municipalities <- get_municipalities(year = 2019, scale = 4500)
municipalities_lonlat <- sf::st_transform(x = municipalities, crs = "+proj=longlat +datum=WGS84")
leaflet(municipalities_lonlat) %>%
addTiles() %>%
addPolygons(color = "coral",
weight = 1,
smoothFactor = 0.5,
opacity = 1.0,
fillOpacity = 0.5,
label = ~nimi,
highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE))
## Interactive map Kuopio ----
zipcodes_lonlat <- sf::st_transform(x = zipcodes_kuopio, crs = "+proj=longlat +datum=WGS84")
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "yellow",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~nimi,
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "darkyellow",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~nimi,
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~nimi,
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## stat.fi
library(pxweb)
pxweb_query_list <-
list("Alue 2019"=c("297"),
"Tiedot"=c("M408","M411","M476","M391","M421","M478","M404","M410","M303","M297","M302","M44","M62","M70","M488","M486","M137","M140","M130","M162","M78","M485","M152","M72","M84","M106","M151","M499","M496","M495","M497","M498"),
"Vuosi"=c("2018"))
px_data <-
pxweb_get(url = "http://pxnet2.stat.fi/PXWeb/api/v1/fi/Kuntien_avainluvut/2019/kuntien_avainluvut_2019_aikasarja.px",
query = pxweb_query_list)
View(px_data)
# Convert to data.frame
tk_data <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")
tk_data
# test zipcodes map
ggplot(zipcodes_kuopio) +
geom_sf(aes(fill = as.integer(posti_alue)))
# transform to lonlat for leaflet
zipcodes_lonlat <- sf::st_transform(x = zipcodes_kuopio, crs = "+proj=longlat +datum=WGS84")
zipcodes_kuopio$posti_alue
pxweb_query_list <-
list("Alue 2019"=zipcodes_kuopio$posti_alue,
"Tiedot"=c("M408","M411","M476","M391","M421","M478","M404","M410","M303","M297","M302","M44","M62","M70","M488","M486","M137","M140","M130","M162","M78","M485","M152","M72","M84","M106","M151","M499","M496","M495","M497","M498"),
"Vuosi"=c("2018"))
px_data <-
pxweb_get(url = "http://pxnet2.stat.fi/PXWeb/api/v1/fi/Kuntien_avainluvut/2019/kuntien_avainluvut_2019_aikasarja.px",
query = pxweb_query_list)
d
zipcodes_kuopio$posti_alue # kuopion postinumerot
pxweb_query_list <- list("Postinumeroalue" = zipcodes_kuopio$posti_alue,
"Tiedot" = c("He_vakiy"))
px_data <- pxweb_get(url = "http://pxnet2.stat.fi/PXWeb/api/v1/fi/Postinumeroalueittainen_avoin_tieto/2019/paavo_1_he_2019.px",
query = pxweb_query_list)
tk_data <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")
tk_data
View(tk_data)
str(tk_data)
tk_data <- tk_data %>%
rename(vakiluku = `Paavo - Postinumeroalueittainen avoin tieto 2019`)
View(tk_data)
# Convert to data.frame
tk_data <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")
# tk_data$`Paavo - Postinumeroalueittainen avoin tieto 2019`
tk_data <- tk_data %>%
rename(vakiluku = `Paavo - Postinumeroalueittainen avoin tieto 2019`) %>%
mutate(posti_alue = substr(Postinumeroalue, 1,5))
str(tk_data)
# Convert to data.frame
tk_data <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")
# tk_data$`Paavo - Postinumeroalueittainen avoin tieto 2019`
tk_data <- tk_data %>%
rename(vakiluku_2017 = `Paavo - Postinumeroalueittainen avoin tieto 2019`) %>%
mutate(posti_alue = substr(Postinumeroalue, 1,5)) %>%
select(-Tiedot) %>%
as_tibble()
View(tk_data)
# Convert to data.frame
tk_data <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")
# tk_data$`Paavo - Postinumeroalueittainen avoin tieto 2019`
tk_data <- tk_data %>%
rename(vakiluku_2017 = `Paavo - Postinumeroalueittainen avoin tieto 2019`) %>%
mutate(posti_alue = substr(Postinumeroalue, 1,5)) %>%
select(-Tiedot) %>%
janitor::clean_names() %>%
as_tibble()
View(tk_data)
zipcodes_kuopio
# Join with Statistics Finland attribute data
dat <- left_join(zipcodes_kuopio, tk_data)
dat
View(dat)
zipcodes_lonlat <- sf::st_transform(x = dat, crs = "+proj=longlat +datum=WGS84")
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~nimi,
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
View(dat)
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~vakiluku_2017,
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
View(dat)
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~nimi,
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE)) %>%
addMarkers(clusterOptions = markerClusterOptions())
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~nimi,
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE)) %>%
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~nimi,
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE)) %>%
addMarkers()
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~nimi,
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE)) %>%
addMarkers(~Long, ~Lat, popup = ~htmlEscape(nimi))
View(dat)
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
# label = ~nimi,
highlightOptions = highlightOptions(color = "white",
label = ~nimi,
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~nimi + ~vakiluku,
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~nimi ~vakiluku,
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
dat$vakiluku_2017
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = paste0(~nimi, ~vakiluku_2017),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = paste0(nimi, vakiluku_2017),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~paste0(nimi, vakiluku_2017),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~paste(nimi, vakiluku_2017),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~paste(nimi, "\n" vakiluku_2017),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~paste(nimi, "\n", vakiluku_2017),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~paste(nimi, "\\n", vakiluku_2017),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~paste(nimi, "V채kiluku (2017):", vakiluku_2017),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~paste(posti_alue, nimi, "V채kiluku (2017):", vakiluku_2017),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~paste(posti_alue, nimi, "V채kiluku (2017):", vakiluku_2017, sep = "\n"),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~paste(nimi, "(", posti_alue ,")", vakiluku_2017, "asukasta"),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillOpacity = 0.5,
label = ~paste0(nimi, " (", posti_alue ,") ", vakiluku_2017, " asukasta"),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillColor = ~vakiluku_2017,
fillOpacity = 0.5,
label = ~paste0(nimi, " (", posti_alue ,") ", vakiluku_2017, " asukasta"),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillColor = ~colorQuantile(vakiluku_2017),
fillOpacity = 0.5,
label = ~paste0(nimi, " (", posti_alue ,") ", vakiluku_2017, " asukasta"),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillColor = ~colorQuantile(palette = "YlOrRd", vakiluku_2017)(vakiluku_2017),
fillOpacity = 0.5,
label = ~paste0(nimi, " (", posti_alue ,") ", vakiluku_2017, " asukasta"),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
sum(dat$vakiluku_2017)
pxweb_query_list <- list("Postinumeroalue" = zipcodes_kuopio$posti_alue,
"Tiedot" = c("He_vakiy", "He_kika"))
px_data <- pxweb_get(url = "http://pxnet2.stat.fi/PXWeb/api/v1/fi/Postinumeroalueittainen_avoin_tieto/2019/paavo_1_he_2019.px",
query = pxweb_query_list)
# Convert to data.frame
tk_data <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")
tk_data
tk_data
tk_data <- tk_data %>%
rename(avointieto = `Paavo - Postinumeroalueittainen avoin tieto 2019`) %>%
mutate(posti_alue = substr(Postinumeroalue, 1,5)) %>%
spread(Tiedot, avointieto) %>%
janitor::clean_names() %>%
as_tibble()
View(tk_data)
# Join with Statistics Finland attribute data
dat <- left_join(zipcodes_kuopio, tk_data)
# transform to lonlat for leaflet
# zipcodes_lonlat <- sf::st_transform(x = zipcodes_kuopio, crs = "+proj=longlat +datum=WGS84")
zipcodes_lonlat <- sf::st_transform(x = dat, crs = "+proj=longlat +datum=WGS84")
## mapplot ----
leaflet(zipcodes_lonlat) %>%
addTiles() %>%
addPolygons(color = "#ebc034",
weight = 1,
smoothFactor = .5,
opacity = .9,
fillColor = ~colorQuantile(palette = "YlOrRd", asukkaat_yhteensa_2017_he)(asukkaat_yhteensa_2017_he),
fillOpacity = 0.5,
label = ~paste0(nimi, " (", posti_alue ,") ", asukkaat_yhteensa_2017_he, " asukasta (keski-ik채 ",asukkaiden_keski_ika_2017_he," vuotta)"),
highlightOptions = highlightOptions(color = "white",
weight = 2,
bringToFront = TRUE))
